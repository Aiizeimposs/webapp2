<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏°‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</title>
  <style>
    body { font-family: sans-serif; padding: 2rem; background-color: #fdf6f6; }
    label, select, input { margin: 5px 0; display: block; }
    table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
    th, td { padding: 10px; border: 1px solid #ddd; }
    th { background-color: #f2f2f2; }
  </style>
</head>
<body>

  <h2>‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏°‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h2>

  <label for="className">‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô:</label>
  <select id="className">
    <option value="‡∏°.1/1">‡∏°.1/1</option>
    <option value="‡∏°.1/2">‡∏°.1/2</option>
    <option value="‡∏°.1/3">‡∏°.1/3</option>
    <option value="‡∏°.2/1">‡∏°.2/1</option>
    <option value="‡∏°.2/2">‡∏°.2/2</option>
    <option value="‡∏°.2/3">‡∏°.2/3</option>
  </select>

  <label for="date">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà (YYYY-MM-DD):</label>
  <input type="date" id="date">

  <button onclick="loadAttendance()">‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>

  <div id="result" style="margin-top: 20px;"></div>

 
  <script>
  function formatDateToThai(dateStr) {
    const date = new Date(dateStr);
    const day = String(date.getDate()).padStart(2, '0');
    const month = String(date.getMonth() + 1).padStart(2, '0');
    const buddhistYear = date.getFullYear() + 543; // ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô ‡∏û.‡∏®.
    return `${day}/${month}/${buddhistYear}`;
  }

  function loadAttendance() {
  const className = document.getElementById('className').value;
  const dateInput = document.getElementById('date').value;

  if (!dateInput) {
    document.getElementById('result').innerHTML = '‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà';
    return;
  }

  // ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏õ‡∏•‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏ó‡∏¢‡πÅ‡∏•‡πâ‡∏ß ‡∏™‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô YYYY-MM-DD ‡πÑ‡∏õ‡πÄ‡∏•‡∏¢
  const dateText = dateInput;

  const url = `https://script.google.com/macros/s/AKfycbzmQQdkY4f9aC5NCOw4gK0dYc-Do3cQSgRPlBHyIkxFVIJpjEX8wgyhgU6M6-_jSDwfig/exec?api=true&action=attendance&class=${encodeURIComponent(className)}&date=${encodeURIComponent(dateText)}`;


  fetch(url)
    .then(response => {
      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }
      return response.json();
    })
    .then(data => {
      if (data.error) {
        document.getElementById('result').innerHTML = `‚ùå ${data.error}`;
      } else if (data.html) {
        document.getElementById('result').innerHTML = data.html;
      } else {
        document.getElementById('result').innerHTML = 'ü§î ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á';
      }
    })
    .catch(error => {
      document.getElementById('result').innerHTML = 'üö´ ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message;
      console.error('Fetch error:', error); // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£ Log ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏ô‡∏Å‡∏≤‡∏£ Debug
    });
}
</script>


</body>
</html>
